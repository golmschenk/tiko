---

- name: 'install_common_user_tools'
  hosts: '{{ passed_hosts | default("localhost") }}'
  connection: '{{ "ssh" if (passed_hosts | default([]) | length) > 0 else "local" }}'
  environment:
    PATH: "{{ ansible_env.HOME }}/.cargo/bin:{{ ansible_env.PATH }}"
  tasks:
    - name: 'check_for_cargo'
      shell: 'command -v cargo'
      register: 'cargo_check'
      changed_when: false
      failed_when: false

    - name: 'install_cargo'
      shell: "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile minimal --default-toolchain stable"
      when: 'cargo_check.rc != 0'

...
